<apex:page id="eDocument" standardController="Task" extensions="EDocumentController">
    <apex:variable var="bar" value="foo" rendered="{!showPDF}">
        <div id="pdf" style="height:100% !important;"></div>
    </apex:variable>
    <apex:variable var="foo" value="bar" rendered="{!isError}">
        <div id="error">
            {!$Label.eDocumentNotAvailable}
        </div>
    </apex:variable>
    <script>
        function dataURItoBlob(dataURI) {
            var byteString = atob(dataURI.split(',')[1]);
            var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]
            var ab = new ArrayBuffer(byteString.length);
            var ia = new Uint8Array(ab);
            for (var i = 0; i < byteString.length; i++) {
                ia[i] = byteString.charCodeAt(i);
            }
            var blob = new Blob([ab], { type: mimeString });
            return blob;
        }
        if ('{!showPDF}') {
            let base64data = "data:application/pdf;base64,{!base64Data}";
            const blob = dataURItoBlob(base64data);
            var temp_url = window.URL.createObjectURL(blob) + '#toolbar=0';
            const target = document.querySelector('#pdf');
            target.innerHTML = `<iframe src='${temp_url}' id="pdfFrame" width="100%" height="100%" frameborder="0" type="application/pdf"></iframe>`;
            document.getElementById('pdfFrame').height = window.innerHeight;
        }

        EDocumentController.createAccessLogRecord(
            '{!letterId}', '{!letterType}', '{!recordId}',
            function (result, event) { },
            { escape: true }
        );
    </script>
</apex:page>